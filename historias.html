<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baú de Memórias ❤️</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .grid-historico { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 10px; margin-top: 20px; }
        .item-memoria { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer; border: 2px solid #fff; }
        .item-memoria img { width: 100%; height: 120px; object-fit: cover; display: block; }
        
        /* Modal do Zoom */
        #modal-zoom { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:1000; flex-direction:column; justify-content:center; align-items:center; color:white; padding:20px; }
        #modal-img { max-width:100%; max-height:50vh; border-radius:15px; border: 3px solid #e91e63; }
        #modal-texto { margin-top:20px; text-align:center; font-style:italic; line-height:1.6; font-size: 1.1rem; max-width: 90%; overflow-y: auto; }
        .btn-fechar { position:absolute; top:30px; right:30px; font-size:30px; color:white; cursor:pointer; font-weight:bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="titulo-principal">Nossas Memórias</h1>
        <p style="text-align:center; color:#d81b60; font-size:0.9rem;">Toque em uma foto para ler</p>
        
        <div id="lista-memorias" class="grid-historico">
            </div>

        <button onclick="window.location.href='index.html'" style="background:#d81b60; color:white; border:none; padding:12px; border-radius:50px; width:100%; margin-top:30px; font-weight:bold;">
            ← Voltar para Hoje
        </button>
    </div>

    <div id="modal-zoom" onclick="fecharModal()">
        <span class="btn-fechar">&times;</span>
        <img id="modal-img" src="">
        <div id="modal-texto"></div>
    </div>

    <script>
        const API_URL = "https://lingually-categorical-latisha.ngrok-free.dev/";
        
        async function carregarHistorico() {
            try {
                const resp = await fetch(`${API_URL}obter-historico`, {
                    headers: { 'ngrok-skip-browser-warning': 'true' }
                });
                const data = await resp.json();
                const lista = document.getElementById('lista-memorias');
                
                if(data.historico.length === 0) {
                    lista.innerHTML = "<p style='grid-column: span 2; text-align:center; color:#999;'>Ainda não há memórias arquivadas.</p>";
                    return;
                }

                data.historico.forEach(h => {
                    const div = document.createElement('div');
                    div.className = 'item-memoria';
                    div.onclick = (e) => { e.stopPropagation(); abrirModal(h.imagem, h.texto); };
                    div.innerHTML = `<img src="${h.imagem}">`;
                    lista.appendChild(div);
                });
            } catch (e) { console.error(e); }
        }

        function abrirModal(img, texto) {
            document.getElementById('modal-img').src = img;
            document.getElementById('modal-texto').innerText = texto;
            document.getElementById('modal-zoom').style.display = 'flex';
        }

        function fecharModal() {
            document.getElementById('modal-zoom').style.display = 'none';
        }

        window.onload = carregarHistorico;
    </script>
</body>
</html>